# name: test/sql/read_pgn_type_conversions.test
# description: Test typed conversions and conversion error reporting in read_pgn
# group: [read_pgn]

require chess

# Non-fatal conversion failures should still output the row.
query I
SELECT COUNT(*) FROM read_pgn('test/pgn_files/invalid_types.pgn');
----
1

# Invalid-but-non-empty values become NULL and produce parse_error messages.
query IIIIIIIII
SELECT
  WhiteElo IS NULL,
  BlackElo IS NULL,
  UTCDate IS NULL,
  UTCTime IS NULL,
  parse_error LIKE '%Conversion error: WhiteElo=%',
  parse_error LIKE '%Conversion error: BlackElo=%',
  parse_error LIKE '%Conversion error: UTCDate=%',
  parse_error LIKE '%Conversion error: UTCTime=%',
  parse_error LIKE '%chrono:%'
FROM read_pgn('test/pgn_files/invalid_types.pgn')
LIMIT 1;
----
true	true	true	true	true	true	true	true	true
